generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     Int             @id @default(autoincrement())
  nombre                 String
  apellido               String
  dni                    String          @unique
  email                  String          @unique
  password               String
  direccion              String?
  ciudad                 String?
  nacionalidad           String?
  role                   String          @default("AFILIADO")
  fechaAltaObraSocial    DateTime        @default(now())
  estado                 Boolean         @default(true)
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  familyMembers          FamilyMember[]
  appointments           Appointment[]   @relation("AfiliadoAppointment")
  createdStockItems      StockItem[]     @relation("StockCreatedBy")
  passwordResetTokens    PasswordResetToken[]
}

model FamilyMember {
  id        Int    @id @default(autoincrement())
  nombre    String
  parentesco String
  edad      Int?
  dni       String?
  userId    Int
  user      User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Sector {
  id          Int          @id @default(autoincrement())
  nombre      String
  descripcion String?
  doctors     Doctor[]
  appointments Appointment[]
}

model Doctor {
  id         Int          @id @default(autoincrement())
  nombre     String
  apellido   String
  matricula  String
  email      String?
  especialidad String
  sectorId   Int
  sector     Sector       @relation(fields: [sectorId], references: [id])
  appointments Appointment[]
}

model AppointmentType {
  id        Int           @id @default(autoincrement())
  nombre    String        @unique
  descripcion String?
  appointments Appointment[]
}

model Appointment {
  id                           Int                @id @default(autoincrement())
  sectorId                     Int
  doctorId                     Int
  afiliadoId                   Int?
  appointmentTypeId            Int
  fechaHoraInicio              DateTime
  fechaHoraFin                 DateTime
  estado                       String             @default("DISPONIBLE")
  requiereEstudiosComplementarios Boolean        @default(false)
  comentarios                  String?
  createdAt                    DateTime          @default(now())
  updatedAt                    DateTime          @updatedAt
  sector                       Sector            @relation(fields: [sectorId], references: [id])
  doctor                       Doctor            @relation(fields: [doctorId], references: [id])
  afiliado                     User?             @relation("AfiliadoAppointment", fields: [afiliadoId], references: [id])
  appointmentType              AppointmentType   @relation(fields: [appointmentTypeId], references: [id])
}

model StockItem {
  id                     Int            @id @default(autoincrement())
  nombre                 String
  categoria              String
  descripcion            String?
  cantidadActual         Int            @default(0)
  unidadMedida           String         @default("unidades")
  stockMinimo            Int            @default(0)
  stockMaximo            Int?
  ubicacion              String?
  fechaUltimaActualizacion DateTime     @default(now())
  createdById            Int?
  createdBy              User?          @relation("StockCreatedBy", fields: [createdById], references: [id])
}

model PasswordResetToken {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  userId     Int
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt  DateTime
  used       Boolean  @default(false)
  createdAt  DateTime @default(now())
}
